<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>CAMERA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no" />
  <link rel="stylesheet" type="text/css" href="camera.css" />
</head>
<body>
  <div id="main">
    <button id="btn_shot" onclick="func_shot()">撮影</button>
    <div id="video_frame">
      <video id="video"  playsinline></video>
      <script>
        const medias = {
          audio: false,
          video: {
              facingMode: 'environment', //メインカメラ
            width: { min: 1024, ideal: 1920, max: 2436 },
            height: { min: 776, ideal: 1080, max: 1125 }
          }
        };
        const video = document.getElementById("video");
        const promise = navigator.mediaDevices.getUserMedia(medias);

        promise.then(function(stream){
          /* 成功 */
          video.srcObject = stream;
        })
        .catch(function(err) {
          /* エラーをハンドル */
        });

        function func_shot(){
          var canvas = document.getElementById('myCanvas');
          var ctx    = canvas.getContext('2d');
          var width  = video.offsetWidth;
          var height = video.offsetHeight;
          canvas.setAttribute('width' , width);
          canvas.setAttribute('height', height);
          ctx.drawImage(video, 0, 0, width, height);
          //画像をJPEGにしたいとき（これをformでPOSTしたりすればいいです）
          var imageData = canvas.toDataURL("image/jpg");
        }

      </script>
      <canvas id="myCanvas"></canvas>
    </div>
  </div>
</body>
</html>
